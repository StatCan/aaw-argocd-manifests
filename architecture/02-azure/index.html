
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Deployment manifests for the AAW">
      
      
      
      
        <link rel="canonical" href="https://statcan.github.io/aaw-argocd-manifests/architecture/02-azure/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Azure Resources - AAW ArgoCD Manifests</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-resources" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AAW ArgoCD Manifests" class="md-header__button md-logo" aria-label="AAW ArgoCD Manifests" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AAW ArgoCD Manifests
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure Resources
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AAW ArgoCD Manifests" class="md-nav__button md-logo" aria-label="AAW ArgoCD Manifests" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AAW ArgoCD Manifests
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../00-introduction/" class="md-nav__link">
        Securing Advanced Analytics Workspaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-limitations/" class="md-nav__link">
        Limitations
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Azure Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Azure Resources
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#subscription" class="md-nav__link">
    Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-groups" class="md-nav__link">
    Resource groups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-naming" class="md-nav__link">
    Resource naming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    Networking
  </a>
  
    <nav class="md-nav" aria-label="Networking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    Firewall
  </a>
  
    <nav class="md-nav" aria-label="Firewall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azure-firewall" class="md-nav__link">
    Azure Firewall
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-security-groups-nsgs" class="md-nav__link">
    Network Security Groups (NSGs)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-storage" class="md-nav__link">
    Disk storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-kubernetes-service-aks" class="md-nav__link">
    Azure Kubernetes Service (AKS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-as-code" class="md-nav__link">
    Infrastructure as Code
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-classification/" class="md-nav__link">
        Classification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04-storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-network/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06-kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07-kubeflow/" class="md-nav__link">
        Kubeflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../08-appendix-a/" class="md-nav__link">
        Appendix A: Non-security recommendations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Daaas system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Daaas system" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Daaas system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/namespace-controller/">Namespace controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Namespace controller" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Namespace controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/network-policies/">Network policies</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Network policies" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Network policies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-controllers/">Notebook controllers</a>
          
            <label for="__nav_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook controllers" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Notebook controllers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-controllers/goofys-injector/">Goofys injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Goofys injector" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Goofys injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-controllers/minio-credential-injector/">Minio credential injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Minio credential injector" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Minio credential injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_4" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-controllers/notebook-auth-policy-checker/">Notebook auth policy checker</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook auth policy checker" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Notebook auth policy checker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_4" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-restarting/">Notebook restarting</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook restarting" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Notebook restarting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" data-md-state="indeterminate" type="checkbox" id="__nav_3_5" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/notebook-scanning/">Notebook scanning</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook scanning" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Notebook scanning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" data-md-state="indeterminate" type="checkbox" id="__nav_3_6" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/profile-controllers/">Profile controllers</a>
          
            <label for="__nav_3_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Profile controllers" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Profile controllers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_6_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/profile-controllers/kubeflow-controller/">Kubeflow controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Kubeflow controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_6_2">
          <span class="md-nav__icon md-icon"></span>
          Kubeflow controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_6_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/profile-controllers/profiles-controller/">Profiles controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Profiles controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_6_3">
          <span class="md-nav__icon md-icon"></span>
          Profiles controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" data-md-state="indeterminate" type="checkbox" id="__nav_3_7" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Serving
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Serving" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Serving
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7_1" data-md-state="indeterminate" type="checkbox" id="__nav_3_7_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/serving/inferenceservices-controller/">Inferenceservices controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Inferenceservices controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_7_1">
          <span class="md-nav__icon md-icon"></span>
          Inferenceservices controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" data-md-state="indeterminate" type="checkbox" id="__nav_3_8" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../daaas-system/workflows-cronjob/">Workflows cronjob</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Workflows cronjob" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Workflows cronjob
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Monitoring system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Monitoring system" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Monitoring system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" data-md-state="indeterminate" type="checkbox" id="__nav_4_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../monitoring-system/elastic/">Elastic</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Elastic" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Elastic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Profiles argocd system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Profiles argocd system" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Profiles argocd system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" data-md-state="indeterminate" type="checkbox" id="__nav_5_1" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Template
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Template" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Template
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_1" data-md-state="indeterminate" type="checkbox" id="__nav_5_1_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../profiles-argocd-system/template/gitea/">Gitea</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gitea" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_1">
          <span class="md-nav__icon md-icon"></span>
          Gitea
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          Statcan system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Statcan system" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Statcan system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" data-md-state="indeterminate" type="checkbox" id="__nav_6_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../statcan-system/gatekeeper/">Gatekeeper</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gatekeeper" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Gatekeeper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" data-md-state="indeterminate" type="checkbox" id="__nav_6_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../statcan-system/sidecar-terminator/">Sidecar terminator</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Sidecar terminator" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Sidecar terminator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" data-md-state="indeterminate" type="checkbox" id="__nav_6_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../statcan-system/toleration-injector/">Toleration injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Toleration injector" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Toleration injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7">
          Storage system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Storage system" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Storage system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" data-md-state="indeterminate" type="checkbox" id="__nav_7_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../storage-system/kustomize-gateway/">Kustomize gateway</a>
          
            <label for="__nav_7_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Kustomize gateway" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Kustomize gateway
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_2" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../storage-system/kustomize-gateway/base/">Base</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Base" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_2">
          <span class="md-nav__icon md-icon"></span>
          Base
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_3" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_1_3">
          Overlays
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overlays" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_3">
          <span class="md-nav__icon md-icon"></span>
          Overlays
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_3_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../storage-system/kustomize-gateway/overlays/gateway-bundle/">Gateway bundle</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gateway bundle" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          Gateway bundle
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#subscription" class="md-nav__link">
    Subscription
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-groups" class="md-nav__link">
    Resource groups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-naming" class="md-nav__link">
    Resource naming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    Networking
  </a>
  
    <nav class="md-nav" aria-label="Networking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firewall" class="md-nav__link">
    Firewall
  </a>
  
    <nav class="md-nav" aria-label="Firewall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#azure-firewall" class="md-nav__link">
    Azure Firewall
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-security-groups-nsgs" class="md-nav__link">
    Network Security Groups (NSGs)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disk-storage" class="md-nav__link">
    Disk storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-kubernetes-service-aks" class="md-nav__link">
    Azure Kubernetes Service (AKS)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-as-code" class="md-nav__link">
    Infrastructure as Code
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="azure-resources">Azure Resources</h1>
<p>The Advanced Analytics Workspaces (AAW) runs within the Azure Cloud
environment. Thus, it's critical that the Azure resources be correctly
configured to provide a secure context for the AAW and its associated
Protected B workloads. This section discusses the proposed
implementation of these Azure resources. Simply put,
the following diagram depicts the overall layout of the Azure
resources (based on network configuration):</p>
<p><img alt="Network layout diagram" src="../assets/images/network.svg" /></p>
<p>Let's deep dive down to the difference resources and how they are
proposed to be configured.</p>
<h2 id="subscription">Subscription</h2>
<p>Currently, the AAW environment lives in the <code>vdl</code> subscription. As it stands,
there are many person and non-person entities who have full access to resources
within the subscription (<code>Owner</code> or <code>Contributor</code> at the subscription level),
many of whom are not related to or associated with the AAW project.
This provides a high level of risk of many accidental or unauthorized
activities within the environment, including:</p>
<ul>
<li>Accidental or malicious removal of resources</li>
<li>Accidental or malicious removal of security policies</li>
<li>Malicious access to unauthorized resources</li>
</ul>
<p>While generally users with access to the environment are trusted by the
organization, most users do not have a need to have this access within
the AAW environment. Therefore, this is directly in violation of
the principle of least privilege.</p>
<blockquote>
<p><strong>Recommendation AZ-SUB-01</strong>: The AAW be moved to its own subscription with
limited person and non-person entities who have <code>Owner</code> or <code>Contributor</code>
at the subscription level.</p>
</blockquote>
<h2 id="resource-groups">Resource groups</h2>
<blockquote>
<p><strong>Recommendation AZ-RG-01</strong>: The following resource groups be created with
the defined purpose:</p>
<ul>
<li><code>aaw-$env-$region-$num-rg-network</code>: Network resources (VNET, Firewall)</li>
<li><code>aaw-$env-$region-$num-rg-aks</code>: AKS resources (AKS, Container Registry)</li>
<li><code>aaw-$env-$region-$num-rg-aks-managed</code>: AKS managed resources for each cluster</li>
<li><code>aaw-$env-$region-$num-rg-backup</code>: Backup resources (Velero)</li>
<li><code>aaw-$env-$region-$num-rg-security</code>: Security resources (e.g.
   Vault KeyVault, Storage Account)</li>
<li><code>aaw-$env-$region-$num-rg-data</code>: Data resources (e.g. Databases)</li>
</ul>
<p>(see below for variable values)</p>
</blockquote>
<h2 id="resource-naming">Resource naming</h2>
<blockquote>
<p><strong>Recommendation AZ-RN-01</strong>: The naming convention of Azure resources be:</p>
<p><code>aaw-$env-$region-$num-$type-$purpose</code>, where:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$type</code></td>
<td>The resource type, usually abbreviated</td>
</tr>
<tr>
<td><code>$region</code></td>
<td>The region of the resource, if region-specific. Usually <code>cc</code>, for Canada Central</td>
</tr>
<tr>
<td><code>$num</code></td>
<td>The instance number of AAW in that env/region, starting at <code>00</code></td>
</tr>
<tr>
<td><code>$env</code></td>
<td>The environment of the resource, usually <code>prod</code> or <code>dev</code></td>
</tr>
<tr>
<td><code>$purpose</code></td>
<td>If multiple resources of this type are deployed in this env/region/num, then the purpose of the resource should be appended at end</td>
</tr>
</tbody>
</table>
<p>Common Azure resources and their abbreviations:</p>
<table>
<thead>
<tr>
<th>Abbreviation</th>
<th>Resource</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rg</code></td>
<td>Resource group</td>
</tr>
<tr>
<td><code>vnet</code></td>
<td>Virtual network</td>
</tr>
<tr>
<td><code>snet</code></td>
<td>Subnet</td>
</tr>
<tr>
<td><code>rt</code></td>
<td>Route table</td>
</tr>
<tr>
<td><code>fw</code></td>
<td>Firewall</td>
</tr>
<tr>
<td><code>aks</code></td>
<td>Azure Kubernetes Service</td>
</tr>
<tr>
<td><code>cr</code></td>
<td>Container Registry</td>
</tr>
<tr>
<td><code>sa</code></td>
<td>Storage account</td>
</tr>
<tr>
<td><code>msi</code></td>
<td>User assigned managed self identity</td>
</tr>
<tr>
<td><code>kv</code></td>
<td>Azure Key Vault</td>
</tr>
</tbody>
</table>
<p>Example resource names:</p>
<ul>
<li><code>aaw-prod-cc-00-vnet-hub</code>: the hub vnet in the aaw-prod-cc-00 environment</li>
<li><code>aaw-prod-cc-00-aks</code>: the AKS cluster in Canada Central in the aaw-prod-cc-00 environment</li>
</ul>
<p><em>Where resources do not support <code>-</code> in the name, then
the <code>-</code> should be omitted from the resource name.</em></p>
</blockquote>
<h2 id="networking">Networking</h2>
<p>A proper network layout will enable the AAW environment to apply appropriate
rules and restrictions to workloads based on the source and destination
of each connection.</p>
<blockquote>
<p><strong>Recommendation AZ-NW-01</strong>: Each region and environment will be assigned
a network space of /14, broken down into the following Virtual Networks:</p>
<ul>
<li>Hub VNET (/16)</li>
<li>AKS VNET (/16)</li>
<li>Data VNET (/16)</li>
<li>Reserved for future use (/16)</li>
</ul>
<p>A VNET is best given a /16 (65536) of IP space as this is
the maximum number of private IPs permitted in a virtual network: <a href="https://docs.microsoft.com/en-us/azure/firewall/firewall-faq#why-does-azure-firewall-need-a--26-subnet-size">https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/azure-subscription-service-limits#networking-limits</a>.</p>
</blockquote>
<p>This recommendation is referred to as a Hub &amp; Spoke model. This allows us to
maximize the available IP space for the AKS cluster within the AKS VNET. While
this incurrs additional peering costs between the VNETs it is offset but
the increased security posture - in particular if the AAW environment
is peered with other enviroments in the future, as traffic can be forced
through the Azure firewall first.</p>
<blockquote>
<p>Note: The Data VNET / subnets are generally not needed as we can
use Service Endpoints for managed databases and storage accounts.</p>
<p><strong>Recommendation AZ-NW-02</strong>: Each virtual network be broken down
into the following subnets:</p>
<p><em>HUB VNET</em></p>
<table>
<thead>
<tr>
<th>Network</th>
<th>Subnet</th>
<th>Start IP</th>
<th>End IP</th>
<th>Number of IPs</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>firewall</code></td>
<td><code>x.y.255.192/26</code></td>
<td><code>x.y.255.192</code></td>
<td><code>x.y.255.255</code></td>
<td>64</td>
</tr>
</tbody>
</table>
<p><em>AKS VNET</em></p>
<table>
<thead>
<tr>
<th>Network</th>
<th>Subnet</th>
<th>Start IP</th>
<th>End IP</th>
<th>Number of IPs</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>load-balancers</code></td>
<td><code>x.y.254.0/23</code></td>
<td><code>x.y.254.0</code></td>
<td><code>x.y.255.255</code></td>
<td>512</td>
</tr>
<tr>
<td><code>system</code></td>
<td><code>x.y.0.0/18</code></td>
<td><code>x.y.0.0</code></td>
<td><code>x.y.63.255</code></td>
<td>16384</td>
</tr>
<tr>
<td><code>user-unclassified</code></td>
<td><code>x.y.64.0/18</code></td>
<td><code>x.y.64.0</code></td>
<td><code>x.y.127.255</code></td>
<td>16384</td>
</tr>
<tr>
<td><code>user-protected-b</code></td>
<td><code>x.y.128.0/18</code></td>
<td><code>x.y.128.0</code></td>
<td><code>x.y.191.255</code></td>
<td>16384</td>
</tr>
</tbody>
</table>
<p><em>DATA VNET</em></p>
<table>
<thead>
<tr>
<th>Network</th>
<th>Subnet</th>
<th>Start IP</th>
<th>End IP</th>
<th>Number of IPs</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data-unclassified</code></td>
<td><code>x.y.0.0/22</code></td>
<td><code>x.y.0.0</code></td>
<td><code>x.y.3.255</code></td>
<td>1024</td>
</tr>
<tr>
<td><code>data-protected-b</code></td>
<td><code>x.y.4.0/22</code></td>
<td><code>x.y.4.0</code></td>
<td><code>x.y.7.255</code></td>
<td>1024</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="firewall">Firewall</h3>
<h4 id="azure-firewall">Azure Firewall</h4>
<p>The Azure Firewall sits at the edge of the AAW environment and
serves as the last defence between the internal networks
and the general internet.</p>
<blockquote>
<p><strong>Recommendation AZ-FW-01</strong>: The Azure Firewall be used at the edge
of the AAW networks.</p>
<p><strong>Recommendation AZ-FW-02</strong>: The Azure Firewall be configured
with the following rules:</p>
<ol>
<li>Inbound traffic destined for an internal subnet
   shall be permitted to a Load Balancer located in
   the <code>load-balancers</code> subnet.</li>
<li>Outbound traffic from the <code>system</code>, <code>user-protected-b</code>,
   <code>data-unclassified</code> and <code>data-protected-b</code> subnets
   be restricted to essential traffic only, with policies
   unique to each subnet.</li>
<li>Outbound traffic to ports 80/443, and others as needed,
   be permitted from the <code>user-unclassified</code> subnet.</li>
<li>Traffic from <code>user-unclassified</code> be permitted to <code>data-unclassified</code>,
   and the same be applied for <code>protected-b</code>.</li>
</ol>
</blockquote>
<h4 id="network-security-groups-nsgs">Network Security Groups (NSGs)</h4>
<p>The Azure Firewall provides protection between external networks
and the Advanced Analytics Environment, but does not provide
protection for traffic flows within the environment.</p>
<p>Azure provides a Network Security Group (NSG) feature that allows
the control of traffic between subnets in a Virtual Network.</p>
<blockquote>
<p><strong>Recommendation AZ-FW-03</strong>: Network Security Groups (NSGs) be
used to control inter-subnet traffic flows within the same VNET.</p>
<p><strong>Recommendation AZ-FW-04</strong>: Network Security Groups (NSGs) be
configured as:</p>
<ol>
<li><code>load-balancers</code> may accept traffic from any subnet. Restricting
   access to load balancers is done on a per-subnet outbound restriction.</li>
<li><code>system</code> subnet can accept any traffic to and from the <code>user-*</code> subnets.</li>
<li><code>user-*</code> subnets can accept any traffic to/from the system subnet,
   but not between user subnets. These subnets may also access the
   matching <code>data-*</code> subnet.</li>
</ol>
</blockquote>
<h2 id="disk-storage">Disk storage</h2>
<p>Disk encryption at rest is provided by Microsoft out of the box. By default,
however, these encryption keys come from Microsoft. For increased security
of protected data, it is recommended that
<a href="https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview">Customer Managed Keys</a>
be utilized. <em>Note, however, that not all Azure services support customer
managed keys.</em></p>
<p>The use of Customer Managed Keys is recommended by the Center
for Internet Security (CIS) for storing sensitive data, as well
as the ITSG-33 controls SC-28 (PROTECTION OF INFORMATION AT REST)
and SC-12 (CRYPTOGRAPHIC KEY ESTABLISHMENT AND MANAGEMENT).</p>
<blockquote>
<p><strong>Recommendation AZ-STR-01</strong>: Customer Managed Keys be utlized where possible
within the Azure environment.</p>
<p><strong>Recommendation AZ-STR-02</strong>: The Azure Key Vault key for storage encryption
be backed by a Hardware Security Module (HSM).</p>
<p>There are two options:</p>
<ul>
<li>Shared HSM: $1.28/key/month + $0.039/10000 transactions</li>
<li>Single-tenant HSM: $6.208/hour (~$4,600/month)</li>
</ul>
<p>Automatic key rotation should be configured for storage encryption keys,
assuming this is available for all services. If it is not, then manual
rotation should occur every 90 days (3 months).</p>
</blockquote>
<h2 id="azure-kubernetes-service-aks">Azure Kubernetes Service (AKS)</h2>
<p>With the foundational Azure configuration and network configuration,
we can now build the Azure Kubernetes Service (AKS) cluster for the
Advanced Analytics Workspaces environment.</p>
<p>All the functionality discussed above was designed with the understand
of what features are supported and not supported by the Azure Kubernetes
Service. Therefore, the following recommendations are based on the base
Azure concepts presented above.</p>
<blockquote>
<p><strong>Recommendation AZ-AKS-01</strong>: The AAW Kubernetes cluster would be constructed
with the following node pools:</p>
<table>
<thead>
<tr>
<th>Pool</th>
<th>VM Type</th>
<th>Subnet</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>system</code></td>
<td><code>Standard_D16s_v3</code></td>
<td><code>system</code></td>
<td>Running system components of the AAW environment</td>
</tr>
<tr>
<td><code>monitoring</code></td>
<td><code>Standard_E16s_v3</code></td>
<td><code>system</code></td>
<td>Logging and monitoring components of the AAW environment</td>
</tr>
<tr>
<td><code>storage</code></td>
<td><code>Standard_D32s_v3</code></td>
<td><code>system</code></td>
<td>Storage components of the AAW environment</td>
</tr>
<tr>
<td><code>user-unclassified</code></td>
<td><code>Standard_D16s_v3</code></td>
<td><code>user-unclassified</code></td>
<td>Unclassified user workloads</td>
</tr>
<tr>
<td><code>user-gpu-unclassified</code></td>
<td><code>Standard_NC6s_v3</code></td>
<td><code>user-unclassified</code></td>
<td>Unclassified user GPU workloads</td>
</tr>
<tr>
<td><code>user-protected-b</code></td>
<td><code>Standard_D16s_v3</code></td>
<td><code>user-protected-b</code></td>
<td>Protected B user workloads</td>
</tr>
<tr>
<td><code>user-gpu-protected-b</code></td>
<td><code>Standard_NC6s_v3</code></td>
<td><code>user-protected-b</code></td>
<td>Protected B user GPU workloads</td>
</tr>
</tbody>
</table>
<p>The cluster be constructed with the following features enabled:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/egress-outboundtype">User defined routing</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/managed-aad">Azure Active Directory authentication</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/use-managed-identity#bring-your-own-control-plane-mi">Control Plane Managed Identity</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/azure-disk-customer-managed-keys">Customer Managed Keys for disk encryption</a></li>
</ul>
</blockquote>
<p>The best practices in protecting the AKS cluster is to secure access to the
control plane of Kubernetes. The best way to do this is by running a fully
private AKS cluster (using Private Link). Unfortunately, due to reliance
on external tooling such as GitHub Actions, this is not possible. Therefore,
the next best option is to apply firewalls protecting the control plane.</p>
<blockquote>
<p><strong>Recommendation AZ-AKS-02</strong>: Apply control plane firewall which
restricts access to Statistics Canada networks only.</p>
<p><strong>Recommendation AZ-AKS-03</strong>: To manage the Kubernetes cluster from
GitHub Actions, a self-hosted runner should be deployed and utilized
so that access to the API server can be kept limited.</p>
</blockquote>
<h2 id="infrastructure-as-code">Infrastructure as Code</h2>
<blockquote>
<p><strong>Recommendation KUBE-CAC-01</strong>: All Azure resources deployed to the
Advanced Analytics Workspaces environment be managed via
Terraform, a Infrastructure as Code tool.</p>
<p>The only resource exempt from this requirement is the Subscription.</p>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../01-limitations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Limitations" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Limitations
            </div>
          </div>
        </a>
      
      
        
        <a href="../03-classification/" class="md-footer__link md-footer__link--next" aria-label="Next: Classification" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Classification
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Statistics Canada
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>