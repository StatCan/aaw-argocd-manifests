
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Deployment manifests for the AAW">
      
      
      
      
        <link rel="canonical" href="https://statcan.github.io/aaw-argocd-manifests/daaas-system/profile-controllers/profiles-controller/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Index - AAW ArgoCD Manifests</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#profiles-controller" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="AAW ArgoCD Manifests" class="md-header__button md-logo" aria-label="AAW ArgoCD Manifests" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AAW ArgoCD Manifests
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Index
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AAW ArgoCD Manifests" class="md-nav__button md-logo" aria-label="AAW ArgoCD Manifests" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AAW ArgoCD Manifests
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/00-introduction/" class="md-nav__link">
        Securing Advanced Analytics Workspaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/01-limitations/" class="md-nav__link">
        Limitations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/02-azure/" class="md-nav__link">
        Azure Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/03-classification/" class="md-nav__link">
        Classification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/04-storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/05-network/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/06-kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/07-kubeflow/" class="md-nav__link">
        Kubeflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/08-appendix-a/" class="md-nav__link">
        Appendix A: Non-security recommendations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Daaas system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Daaas system" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Daaas system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../namespace-controller/">Namespace controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Namespace controller" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Namespace controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../network-policies/">Network policies</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Network policies" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Network policies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../notebook-controllers/">Notebook controllers</a>
          
            <label for="__nav_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook controllers" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Notebook controllers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../notebook-controllers/goofys-injector/">Goofys injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Goofys injector" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_2">
          <span class="md-nav__icon md-icon"></span>
          Goofys injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../notebook-controllers/minio-credential-injector/">Minio credential injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Minio credential injector" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          Minio credential injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_3_4" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../notebook-controllers/notebook-auth-policy-checker/">Notebook auth policy checker</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook auth policy checker" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          Notebook auth policy checker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_4" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../notebook-scanning/">Notebook scanning</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Notebook scanning" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Notebook scanning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Profile controllers</a>
          
            <label for="__nav_3_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Profile controllers" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Profile controllers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2" data-md-state="indeterminate" type="checkbox" id="__nav_3_5_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../kubeflow-controller/">Kubeflow controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Kubeflow controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_2">
          <span class="md-nav__icon md-icon"></span>
          Kubeflow controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_3" type="checkbox" id="__nav_3_5_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href="./">Profiles controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Profiles controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_3">
          <span class="md-nav__icon md-icon"></span>
          Profiles controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" data-md-state="indeterminate" type="checkbox" id="__nav_3_6" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Serving
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Serving" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Serving
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6_1" data-md-state="indeterminate" type="checkbox" id="__nav_3_6_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../serving/inferenceservices-controller/">Inferenceservices controller</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Inferenceservices controller" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_6_1">
          <span class="md-nav__icon md-icon"></span>
          Inferenceservices controller
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" data-md-state="indeterminate" type="checkbox" id="__nav_3_7" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../workflows-cronjob/">Workflows cronjob</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Workflows cronjob" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Workflows cronjob
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Monitoring system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Monitoring system" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Monitoring system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" data-md-state="indeterminate" type="checkbox" id="__nav_4_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../monitoring-system/elastic/">Elastic</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Elastic" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Elastic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Profiles argocd system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Profiles argocd system" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Profiles argocd system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" data-md-state="indeterminate" type="checkbox" id="__nav_5_1" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Template
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Template" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Template
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_1" data-md-state="indeterminate" type="checkbox" id="__nav_5_1_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../profiles-argocd-system/template/gitea/">Gitea</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gitea" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_1">
          <span class="md-nav__icon md-icon"></span>
          Gitea
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          Statcan system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Statcan system" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Statcan system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" data-md-state="indeterminate" type="checkbox" id="__nav_6_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../statcan-system/gatekeeper/">Gatekeeper</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gatekeeper" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Gatekeeper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" data-md-state="indeterminate" type="checkbox" id="__nav_6_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../statcan-system/sidecar-terminator/">Sidecar terminator</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Sidecar terminator" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Sidecar terminator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" data-md-state="indeterminate" type="checkbox" id="__nav_6_3" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../statcan-system/toleration-injector/">Toleration injector</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Toleration injector" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Toleration injector
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7">
          Storage system
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Storage system" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Storage system
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" data-md-state="indeterminate" type="checkbox" id="__nav_7_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../storage-system/kustomize-gateway/">Kustomize gateway</a>
          
            <label for="__nav_7_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Kustomize gateway" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Kustomize gateway
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_2" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_2" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../storage-system/kustomize-gateway/base/">Base</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Base" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_2">
          <span class="md-nav__icon md-icon"></span>
          Base
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_3" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_1_3">
          Overlays
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overlays" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_3">
          <span class="md-nav__icon md-icon"></span>
          Overlays
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3_1" data-md-state="indeterminate" type="checkbox" id="__nav_7_1_3_1" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../storage-system/kustomize-gateway/overlays/gateway-bundle/">Gateway bundle</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Gateway bundle" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          Gateway bundle
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-create-a-controller" class="md-nav__link">
    How to Create a Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controllers-that-deploy-per-namespace-applications" class="md-nav__link">
    Controllers that Deploy Per-Namespace Applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terminology" class="md-nav__link">
    Terminology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controllers" class="md-nav__link">
    Controllers
  </a>
  
    <nav class="md-nav" aria-label="Controllers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authpolicygo" class="md-nav__link">
    authpolicy.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blob-csigo" class="md-nav__link">
    blob-csi.go
  </a>
  
    <nav class="md-nav" aria-label="blob-csi.go">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    Local Development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#giteago" class="md-nav__link">
    gitea.go
  </a>
  
    <nav class="md-nav" aria-label="gitea.go">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gitea-user-interface" class="md-nav__link">
    Gitea User Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitrangego" class="md-nav__link">
    limitrange.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#miniogo" class="md-nav__link">
    minio.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networkgo" class="md-nav__link">
    network.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notebookgo" class="md-nav__link">
    notebook.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quotasgo" class="md-nav__link">
    quotas.go
  </a>
  
    <nav class="md-nav" aria-label="quotas.go">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quota-labels" class="md-nav__link">
    Quota Labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rbacgo" class="md-nav__link">
    rbac.go
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rootgo" class="md-nav__link">
    root.go
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <p><a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller"><code>profiles-controller</code></a></p>
<h1 id="profiles-controller">profiles-controller</h1>
<p>This repository implements custom controllers for watching <code>Profile</code> resources from Kubeflow.</p>
<h2 id="overview">Overview</h2>
<p>The diagram below illustrates how profiles controller components are rolled out on the cluster.[^1][^2]<a href="Moby" title="Docker) icon provided by [icons8](https://icons8.com/icons/set/docker">^3</a></p>
<p><img alt="Kubeflow Profile Controller Overview" src="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/docs/diagrams/profiles_controller_overview.png" /></p>
<p>[^1]: Gitlab icons provided by <a href="https://about.gitlab.com/press/press-kit/">Gitlab Press Kit</a>.
[^2]: Github icons provided by <a href="https://github.com/logos">Github logos</a>.
[^3]: Argo icon provided by <a href="https://cncf-branding.netlify.app/projects/argo/">CNCF branding</a>.</p>
<h3 id="how-to-create-a-controller">How to Create a Controller</h3>
<p><strong>Note</strong>: Modifying a controller is a subset of these steps; if you are only updating an existing controller, ignore the steps that don't apply.</p>
<ol>
<li>Create a <code>.go</code> file in the <code>cmd</code> folder of <strong>this</strong> repository with the name of your controller. Your controller must create a <code>cobra.Command</code> and register it with the <code>rootCmd</code> of the application. Your controller will be invoked with the entrypoint <code>./profiles-controller &lt;your controller name&gt;</code>.</li>
<li>Modify the profiles-controller helm chart in the <a href="https://github.com/StatCan/charts">StatCan charts</a> repo. Add the deployment containing your new controller and update the <code>values.yaml</code> file accordingly with any new parameters specific to your container. <strong>Don't forget to increment the helm chart version if you made changes to the helm chart</strong>.</li>
<li>Once your new controller is ready, merge your branch to the <code>main</code> branch of <strong>this</strong> repository. A Github action in <strong>this</strong> repository runs a build job (see <code>.github/workflows/build.yml</code>) that builds the profiles-controller container image and pushes it to Azure container registry. The pushed image is tagged with the commit SHA of the git commit that triggered the Github Action.</li>
<li>Go to the build job in the Github action and copy the commit SHA that the image is tagged with to your clipboard. This can be found at the top of the step called <strong>Run docker build</strong> in the <strong>build</strong> job.</li>
<li>Go to the <a href="https://github.com/StatCan/aaw-argocd-manifests">aaw-argocd-manifests</a> repository and open the <code>application.jsonnet</code> file that deploys the <code>profiles-controller</code> ArgoCD application in the <code>daaas-system</code> namespace. In this file, paste the commit SHA from the previous step to the <code>image.tag</code> field. This updates the image tag for the base image used by the <code>profiles-controller</code> deployment. Note that you can make this edit directly through Github's editing features. This edit should be merged into either the <code>aaw-dev-cc-00</code> branch or the <code>aaw-prod-cc-00</code> branch depending on whether the update applies to the dev or prod environments. The <code>profiles-controller</code> ArgoCD application watches for changes to the <code>application.jsonnet</code> file on these branches.</li>
</ol>
<h3 id="controllers-that-deploy-per-namespace-applications">Controllers that Deploy Per-Namespace Applications</h3>
<p>Some controllers deploy per-namespace applications for each user (e.g. Gitea, S3Proxy). In this case, a few additional steps may be required.</p>
<ol>
<li>The <code>profiles-argocd-system</code> folder of the <a href="https://github.com/StatCan/aaw-argocd-manifests">aaw-argocd-manifests</a> repository contains manifests that get deployed by per-namespace ArgoCD applications. The intended pattern is that Kubernetes manifests are applied directly with Kustomize patches as required.</li>
<li>Depending on what a particular per-namespace application looks like, there may be a manual step required where a developer must build the manifests by, for example, templating a helm chart and saving the output in a <code>manifest.yaml</code> file. In this case, a PR must be made to either the <code>aaw-dev-cc-00</code> or <code>aaw-prod-cc-00</code> branches of the aaw-argocd-manifests repo with the newly build <code>manifest.yaml</code> file.</li>
</ol>
<h2 id="terminology">Terminology</h2>
<p>Helpful links to k8s resources, technologies and other terminologies related to this project are provided below.</p>
<ul>
<li><a href="https://www.kubeflow.org/docs/components/multi-tenancy/getting-started/">Profile</a></li>
<li><a href="https://istio.io/latest/docs/reference/config/security/authorization-policy/#Source">Istio AuthorizationPolicy</a></li>
<li><a href="https://kubernetes.io/docs/concepts/policy/limit-range/">LimitRange</a></li>
<li><a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">ResourceQuotas</a></li>
<li><a href="https://www.kubeflow.org/docs/components/notebooks/overview/">Kubeflow Notebook</a></li>
<li><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Roles and RoleBinding (RBAC)</a></li>
<li><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a></li>
<li><a href="https://github.com/kubernetes-sigs/blob-csi-driver">Blob CSI Driver</a></li>
<li><a href="https://www.openpolicyagent.org/">Open Policy Agent (OPA)</a></li>
</ul>
<h2 id="details">Details</h2>
<p>The profiles controller uses <a href="https://github.com/kubernetes/client-go/tree/master/tools/cache">client-go library</a> extensively.
The details of interaction points of the profiles controller with various mechanisms from this library are
explained <a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/docs/controller-client-go.md">here</a>.</p>
<h2 id="controllers">Controllers</h2>
<p>The <a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd">cmd</a> package contains source files for a variety of profile controllers for Kubeflow.</p>
<p>For more information about profile controllers, see the documentation for the <a href="https://github.com/kubernetes/client-go/">client-go</a> library, which contains a variety of mechanisms for use when
developing custom profile controllers. The mechanisms are defined in the
<a href="https://github.com/kubernetes/client-go/tree/master/tools/cache">tools/cache folder</a> of the library.</p>
<h3 id="authpolicygo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/authpolicy.go">authpolicy.go</a></h3>
<p>Responsible for creating, removing and updating <a href="https://istio.io/latest/docs/reference/config/security/authorization-policy/#Source">Istio Authorization Policies</a> using the <a href="https://github.com/istio/client-go">Istio client</a> for a given <code>Profile</code>. Currently, the only <code>AuthorizationPolicy</code> is to block upload/download from protected-b <code>Notebook</code>'s.</p>
<h3 id="blob-csigo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/blob-csi.go">blob-csi.go</a></h3>
<p>Creates an Azure Blob Storage container for a user in a few storage accounts (e.g. <code>standard</code>, <code>protected-b</code>, etc.) and binds a PersistentVolume to the container using the <a href="https://github.com/kubernetes-sigs/blob-csi-driver">blob-csi driver</a>. This relies on secrets stored in a system namespace --- secrets are not accessible by users. The controller also creates a PVC in the users namespace bound to this specific PV.</p>
<ul>
<li>Supports read-write and read-only PersistentVolumes using mountOptions.</li>
<li>PVCs are ReadWriteMany or ReadOnlyMany, respectively</li>
<li>Supports both protected-b and unclassified mounts.</li>
</ul>
<p>In addition, the controller is responsible for managing links from <code>PersistentVolume</code>'s to any buckets from Fair Data Infrastructure (FDI) Section of DAaas.  This is accomplished by querying unclassified and protected-b <code>OPA</code> gateways which return <code>json</code> responses containing buckets along with permissions. The controller parses the returned <code>json</code>, creating a <code>PersistentVolume</code> and <code>PersistentVolumeClaim</code> for each bucket in accordance with the permission constraints.</p>
<h4 id="configuration">Configuration</h4>
<ul>
<li><code>BLOB_CSI_FDI_OPA_DAEMON_TICKER_MILLIS</code>: the time interval at which the opa gateways are queried, in milliseconds. </li>
<li><code>BLOB_CSI_FDI_UNCLASS_OPA_ENDPOINT</code>: the http address pointing to the unclassified OPA gateway.</li>
<li><code>BLOB_CSI_FDI_UNCLASS_SPN_SECRET_NAME</code>: the name of a secret containing data <code>azurestoragespnclientsecret: value</code>,
where value is a secret registered under the unclassified FDI service principal.</li>
<li><code>BLOB_CSI_FDI_UNCLASS_SPN_SECRET_NAMESPACE</code>: the namespace the above secret is contained in.</li>
<li><code>BLOB_CSI_FDI_UNCLASS_PV_STORAGE_CAP</code>: the storage capacity for FDI PV's.</li>
<li><code>BLOB_CSI_FDI_UNCLASS_AZURE_STORAGE_AUTH_TYPE</code>: for the current implementation, only <code>spn</code> auth type is supported</li>
<li><code>BLOB_CSI_FDI_UNCLASS_AZURE_STORAGE_AAD_ENDPOINT</code>: the azure active directory endpoint</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_OPA_ENDPOINT</code>: the http address pointing to the protected-b OPA gateway.</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_SPN_SECRET_NAME</code>: the name of a secret containing data <code>azurestoragespnclientsecret: value</code>,
where value is a secret registered under the protected-b FDI service principal.</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_SPN_SECRET_NAMESPACE</code>: the namespace the above secret is contained in.</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_PV_STORAGE_CAP</code>: the storage capacity for FDI PV's.</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_AZURE_STORAGE_AUTH_TYPE</code>: for the current implementation, only <code>spn</code> auth type is supported</li>
<li><code>BLOB_CSI_FDI_PROTECTED_B_AZURE_STORAGE_AAD_ENDPOINT</code>: the azure active directory endpoint</li>
</ul>
<p><em>This will deprecate the minio controller.</em></p>
<h4 id="local-development">Local Development</h4>
<p>The <a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/Taskfile.yml">Taskfile</a> includes task <code>blobcsi:dev</code> for preparing your local environment for development and testing. Due to the controller's dependency on Azure <a href="https://github.com/kubernetes-sigs/blob-csi-driver">blob-csi driver</a> a cluster with the <a href="https://github.com/kubernetes-sigs/blob-csi-driver">blob-csi driver</a> installed is required. As such, it is recommended to debug and test against the development k8s context for AAW. With the local environment configured, the Vscode Debugger can be used through <code>Run and Debug: blobcsi Controller</code> in the debug pane.</p>
<h3 id="giteago"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/gitea.go">gitea.go</a></h3>
<p>Responsible for deploying <a href="https://github.com/go-gitea/gitea">gitea</a> as <a href="https://github.com/argoproj/argo-cd">argocd</a> applications per <code>Profile</code>. Currently, <a href="https://github.com/argoproj/argo-cd">argocd</a> applications are deployed by the gitea controller based on the customized gitea manifest found <a href="https://github.com/StatCan/aaw-argocd-manifests/tree/aaw-dev-cc-00/profiles-argocd-system/template/gitea">here</a>.</p>
<p>The diagram below highlights the key components involved with the Gitea controller[^5]</p>
<p><img alt="Gitea Controller Diagram" src="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/docs/diagrams/gitea_controller.png" /></p>
<h4 id="gitea-user-interface">Gitea User Interface</h4>
<p>The unclassified Gitea user interface is embedded within the <a href="https://github.com/StatCan/aaw-kubeflow-manifests/blob/aaw-dev-cc-00/kustomize/apps/centraldashboard/base/centraldashboard-config.yaml">Kubeflow dashboard</a>'s user interface, rendered by an iframe. Protected-b gitea is setup to be accessible only through a protected-b node, and thus the user is expected to access their protected-b gitea instance within an AAW ubuntu VM, or through the CLI in a protected-b notebook.</p>
<p>Requests to a namespace's Gitea server are made to the Kubeflow base url with the suffix <code>/gitea-unclassified/?ns=&lt;user-namespace&gt;</code>, where the user's namespace is passed as an http parameter. An Istio Virtual Service created by the <code>gitea.go</code> controller contains an http route that redirects traffic from <code>/gitea-unclassified/?ns=&lt;user-namespace&gt;</code> to <code>/gitea-unclassified/&lt;user-namespace&gt;/</code>. A second http route routes traffic from <code>/gitea-unclassified/&lt;user-namespace&gt;/</code> to the Gitea instance in the user's namespace.</p>
<p>The <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-dev-cc-00/profiles-argocd-system/template/gitea/">Gitea application server</a> sets the <code>ROOT_URL</code> environment variable to contain the Kubeflow base URL with the <code>/gitea-unclassified/&lt;user-namespace&gt;/</code>. This is required as it is the application's responsibility to establish the URLS that will be used in the browser to retrieve static assets and send requests to application endpoints.</p>
<p>The Gitea application <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-dev-cc-00/profiles-argocd-system/template/gitea/values.yaml#L37-L45">values.yaml file</a> makes use of <a href="https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/">pod fields as environment variables</a> and <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-interdependent-environment-variables/#define-an-environment-dependent-variable-for-a-container">dependent environment variables</a> to create a <code>ROOT_URL</code> that depends on the user's namespace. Additionally, an <a href="https://github.com/go-gitea/gitea/issues/6397">upstream gitea issue</a> indicates that it is possible to set multiple domains in the <code>ROOT_URL</code> environment variable by using the syntax <code>ROOT_URL=https://(domain1,domain2)/gitea/</code>, which is how the dev/prod domains are set without needing to check the deployment environment.</p>
<p>To allow requests to reach the user's Gitea instance, a Network Policy is set in the user's namespace that allows ingress traffic from the kubeflow-gateway to be sent to any pods in the user's namespace that match the <code>app: gitea &amp;&amp; app.kubernetes.io/instance: gitea-unclassified</code> label selector.</p>
<p>[^5]: Istio icons provided by <a href="https://istio.io/latest/about/media-resources/">Istio Media Resources</a></p>
<h4 id="configuration_1">Configuration</h4>
<p>The Gitea controller is configurable to run in unclassified or protected-b mode. The configuration of the following
parameters thus need set to run the controller:</p>
<ul>
<li><code>GITEA_CLASSIFICATION</code>: the classification the controller should be running against. Currently, <code>unclassified</code> and <code>protected-b</code> are supported
as values.</li>
<li><code>GITEA_PSQL_PORT</code>: port of the postgres instance the gitea application will connect to</li>
<li><code>GITEA_PSQL_ADMIN_UNAME</code>: username of a priviledged user within the postgres instance</li>
<li><code>GITEA_PSQL_ADMIN_PASSWD</code>: password for the above user</li>
<li><code>GITEA_PSQL_MAINTENANCE_DB</code>: maintenance DB name in the postgres instance</li>
<li><code>GITEA_SERVICE_URL</code>: internal Gitea URL is specified in
  <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-dev-cc-00/profiles-argocd-system/template/gitea/manifest.yaml#L350">here</a></li>
<li><code>GITEA_URL_PREFIX</code>: url prefix for redirecting gitea</li>
<li><code>GITEA_SERVICE_PORT</code>: the port exposed by gitea service, as specified
  <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-dev-cc-00/profiles-argocd-system/template/gitea/manifest.yaml#L365">here</a></li>
<li><code>GITEA_BANNER_CONFIGMAP_NAME</code>: gitea banner configmap name (configmap which corresponds to the banner at the top of the gitea ui)</li>
<li><code>GITEA_ARGOCD_NAMESPACE</code>:  namespace for arcocd instance that the controller will install applications into</li>
<li><code>GITEA_ARGOCD_SOURCE_REPO_URL</code>: repository url containing the gitea deployment manifest</li>
<li><code>GITEA_ARGOCD_SOURCE_TARGET_REVISION</code>: git branch to deploy from</li>
<li><code>GITEA_ARGOCD_SOURCE_PATH</code>: path to the manifest from the root of the git source repo</li>
<li><code>GITEA_ARGOCD_PROJECT</code>: argocd instances's project to deploy applications within</li>
<li><code>GITEA_SOURCE_CONTROL_ENABLED_LABEL</code>: this label will be searched for within profiles to indicate if a user has opted in.</li>
</ul>
<p>Within AAW, these variables are defined in the <a href="https://github.com/StatCan/charts/blob/master/stable/profiles-controller/values.yaml">statcan charts repo</a>, and they are configured within the dev <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-dev-cc-00/daaas-system/profile-controllers/profiles-controller/application.jsonnet">argocd-manifests-repo</a> or prod <a href="https://github.com/StatCan/aaw-argocd-manifests/blob/aaw-prod-cc-00/daaas-system/profile-controllers/profiles-controller/application.jsonnet">argocd-manifests-repo</a>.</p>
<h3 id="limitrangego"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/limitrange.go">limitrange.go</a></h3>
<p>Responsible for creating, removing and updating <code>LimitRange</code> resources for a given profile. <code>LimitRange</code> resources are generated to limit the cpu and memory resources for the kubeflow profile's default container. <code>LimitRange</code> resources require the implementation of a controller managing <code>ResourceQuotas</code>, which is provided in this package (see <a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/quotas.go">quotas.go</a>). Implementing <code>LimitRange</code> resources allows any Pod to run associated with the <code>Profile</code>, restricted by a <code>ResourceQuota</code>.</p>
<h3 id="miniogo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/minio.go">minio.go</a></h3>
<p>Responsible for the configuration of MinIO buckets for the given <code>Profile</code>. Configured MinIO buckets may be used by the associated <code>Profile</code> for object storage accessible directly within their notebooks.</p>
<h3 id="networkgo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/network.go">network.go</a></h3>
<p>Responsible for the following networking policies:</p>
<ul>
<li>Ingress from the ingress gateway</li>
<li>Ingress from knative-serving</li>
<li>Egress to the cluster local gateway</li>
<li>Egress from unclassified workloads</li>
<li>Egress from unclassified workloads to the ingress gateway</li>
<li>Egress to port 443 from protected-b workloads</li>
<li>Egress to the daaas-system</li>
<li>Egress to vault</li>
<li>Egress to pipelines</li>
<li>Egress to MinIO</li>
<li>Egress to Elasticsearch</li>
<li>Egress to Artifactory</li>
</ul>
<h3 id="notebookgo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/notebook.go">notebook.go</a></h3>
<p>Responsible for the configuration of <code>Notebook</code> resources within Kubeflow. This controller adds a default option for running a protected-b <code>Notebook</code>.</p>
<h3 id="quotasgo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/quotas.go">quotas.go</a></h3>
<p>Responsible for the generation of <code>ResourceQuotas</code> for a given profile. Management of <code>ResourceQuotas</code> is essential, as it provides the constraint for total amount of compute resources that are consumable within the <code>Profile</code>. Since the <code>ResourceQuotas</code> definition included in <a href="./cmd/quotas.go">quotas.go</a> provides constraints for cpu and memory, the limits for the values must be defined. These limits are defined as <code>LimitRange</code> resources and are managed by <a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/limitrange.go">limitrange.go</a>.</p>
<h4 id="quota-labels"><a href="https://github.com/StatCan/aaw-kubeflow-profiles-controller/issues/16">Quota Labels</a></h4>
<p>In order for ArgoCD to sync <code>Profile</code> resources, the <code>/metadata/labels/</code> field needed to be ignored. However, this field is required in <code>ResourceQuota</code> resource generation. A <code>Label</code> is provided for each type of quota below, which allows <code>ResourceQuotas</code> to be overidden by the controller for each resource type:</p>
<ul>
<li>quotas.statcan.gc.ca/requests.cpu</li>
<li>quotas.statcan.gc.ca/limits.cpu</li>
<li>quotas.statcan.gc.ca/requests.memory</li>
<li>quotas.statcan.gc.ca/limits.memory</li>
<li>quotas.statcan.gc.ca/requests.storage</li>
<li>quotas.statcan.gc.ca/pods</li>
<li>quotas.statcan.gc.ca/services.nodeports</li>
<li>quotas.statcan.gc.ca/services.loadbalancers</li>
</ul>
<p>A special case is considered for overriding gpu resources. Although the label <code>quotas.statcan.gc.ca/gpu</code> exists for the given <code>Profile</code>, the label <code>requests.nvidia.com/gpu</code> is overidden.</p>
<h3 id="rbacgo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/rbac.go">rbac.go</a></h3>
<p>Responsible for the generation of <code>Roles</code> and <code>RoleBinding</code> resources for a given profile.</p>
<p>A <code>Role</code> is created for each <code>Profile</code>, the following <code>RoleBinding</code>'s are created:</p>
<ul>
<li><code>ml-pipeline</code> role binding for the <code>Profile</code>.</li>
<li><code>DAaas-AAW-Support</code> is granted a profile-support cluster role in the namespace for support purposes.</li>
</ul>
<h3 id="rootgo"><a href="https://raw.githubusercontent.com/StatCan/aaw-kubeflow-profiles-controller/main/cmd/root.go">root.go</a></h3>
<p>The root interface for the profile controllers.</p>
<h2 id="deployment">Deployment</h2>
<p>A helm chart for deploying the profile controllers can be found <a href="https://github.com/StatCan/charts/tree/master/stable/profiles-controller">here</a>.
Each controller has a corresponding k8s manifest.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../kubeflow-controller/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Index" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Index
            </div>
          </div>
        </a>
      
      
        
        <a href="../../serving/inferenceservices-controller/" class="md-footer__link md-footer__link--next" aria-label="Next: inferenceservices-controller" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              inferenceservices-controller
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Statistics Canada
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>